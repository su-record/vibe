(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4379:(e,t,i)=>{"use strict";i.d(t,{default:()=>m});var s=i(5155),a=i(2115);let n=()=>({isPlaying:!1,isPaused:!1,isGameOver:!1,score:0,runtime:0,enemies:[],player:{position:{x:155,y:560},size:{width:50,height:60},direction:"left",speed:5}}),r={CANVAS_WIDTH:360,CANVAS_HEIGHT:640,ENEMY_SPAWN_INTERVAL:600,SPEED_INCREASE_INTERVAL:1e4,SPEED_INCREASE_RATE:.05,MIN_ENEMY_SIZE:25,MAX_ENEMY_SIZE:80,PLAYER_SPEED:5};class h{async loadImages(){try{this.luffyImage=new Image,this.akainuImage=new Image;let e=new Promise((e,t)=>{this.luffyImage.onload=e,this.luffyImage.onerror=t,this.luffyImage.src="/luffy.png"}),t=new Promise((e,t)=>{this.akainuImage.onload=e,this.akainuImage.onerror=t,this.akainuImage.src="/akainu.png"});await Promise.all([e,t]),this.imagesLoaded=!0}catch(e){console.error("Failed to load images:",e),this.imagesLoaded=!1}}render(e){if(this.clearCanvas(),!this.imagesLoaded)return void this.renderLoadingState();this.renderUI(e),this.renderPlayer(e.player),this.renderEnemies(e.enemies)}clearCanvas(){this.ctx.fillStyle="#001122",this.ctx.fillRect(0,0,r.CANVAS_WIDTH,r.CANVAS_HEIGHT)}renderUI(e){this.ctx.fillStyle="#fff",this.ctx.font="20px Arial",this.ctx.textAlign="left";let t=Math.floor(e.runtime/1e3);this.ctx.fillText("시간: ".concat(t,"초"),10,30),this.ctx.fillText("점수: ".concat(e.score),10,60)}renderPlayer(e){if(!this.luffyImage){this.ctx.fillStyle="#4ecdc4",this.ctx.fillRect(e.position.x,e.position.y,e.size.width,e.size.height);return}this.ctx.save(),"right"===e.direction?(this.ctx.scale(-1,1),this.ctx.drawImage(this.luffyImage,-(e.position.x+e.size.width),e.position.y,e.size.width,e.size.height)):this.ctx.drawImage(this.luffyImage,e.position.x,e.position.y,e.size.width,e.size.height),this.ctx.restore()}renderEnemies(e){e.forEach(e=>{if(!this.akainuImage){this.ctx.fillStyle="#ff6b6b",this.ctx.fillRect(e.position.x,e.position.y,e.size.width,e.size.height);return}this.ctx.drawImage(this.akainuImage,e.position.x,e.position.y,e.size.width,e.size.height)})}renderLoadingState(){this.ctx.fillStyle="#666",this.ctx.font="16px Arial",this.ctx.textAlign="center",this.ctx.fillText("Loading images...",r.CANVAS_WIDTH/2,r.CANVAS_HEIGHT-50)}constructor(e){this.luffyImage=null,this.akainuImage=null,this.imagesLoaded=!1,this.ctx=e,this.loadImages()}}class o{start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animationId=requestAnimationFrame(this.gameLoop))}stop(){this.isRunning=!1,null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}gameLoop(e){if(!this.isRunning)return;let t=e-this.lastTime;this.lastTime=e,this.updateCallback(t),this.animationId=requestAnimationFrame(this.gameLoop)}constructor(e){this.isRunning=!1,this.lastTime=0,this.animationId=null,this.updateCallback=e,this.gameLoop=this.gameLoop.bind(this)}}class l{init(e){e&&(this.canvas=e),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.canvas&&(this.canvas.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mouseleave",this.handleMouseUp))}cleanup(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.canvas&&(this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchmove",this.handleTouchMove),this.canvas.removeEventListener("touchend",this.handleTouchEnd),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.handleMouseUp))}handleKeyDown(e){this.keys.add(e.key)}handleKeyUp(e){this.keys.delete(e.key)}handleTouchStart(e){if(e.preventDefault(),!this.canvas)return;let t=e.touches[0],i=this.canvas.getBoundingClientRect();this.touchStartX=(t.clientX-i.left)*(this.canvas.width/i.width),this.touchCurrentX=this.touchStartX,this.isDragging=!0}handleTouchMove(e){if(e.preventDefault(),!this.isDragging||!this.canvas)return;let t=e.touches[0],i=this.canvas.getBoundingClientRect();this.touchCurrentX=(t.clientX-i.left)*(this.canvas.width/i.width)}handleTouchEnd(e){e.preventDefault(),this.isDragging=!1}handleMouseDown(e){if(e.preventDefault(),!this.canvas)return;let t=this.canvas.getBoundingClientRect();this.touchStartX=(e.clientX-t.left)*(this.canvas.width/t.width),this.touchCurrentX=this.touchStartX,this.isDragging=!0}handleMouseMove(e){if(e.preventDefault(),!this.isDragging||!this.canvas)return;let t=this.canvas.getBoundingClientRect();this.touchCurrentX=(e.clientX-t.left)*(this.canvas.width/t.width)}handleMouseUp(e){e.preventDefault(),this.isDragging=!1}getMovementDirection(){if(this.keys.has("ArrowLeft"))return"left";if(this.keys.has("ArrowRight"))return"right";if(this.isDragging){let e=this.touchCurrentX-this.touchStartX;if(Math.abs(e)>5)return e<0?"left":"right"}return null}getTouchPosition(){return this.isDragging?this.touchCurrentX:null}isSpacePressed(){return this.keys.has(" ")}constructor(){this.keys=new Set,this.touchStartX=0,this.touchCurrentX=0,this.isDragging=!1,this.canvas=null,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this)}}class c{reset(){this.gameStartTime=Date.now(),this.lastSpawnTime=0,this.baseSpeed=2}shouldSpawnEnemy(e){return e-this.lastSpawnTime>r.ENEMY_SPAWN_INTERVAL}createEnemy(){this.lastSpawnTime=Date.now();let e=.8*Math.random()+.3,t=r.MIN_ENEMY_SIZE+(r.MAX_ENEMY_SIZE-r.MIN_ENEMY_SIZE)*e,i=this.getCurrentSpeed();return{position:{x:Math.random()*(r.CANVAS_WIDTH-t),y:-t},size:{width:t,height:t},speed:i*(2-e),scale:e}}updateEnemies(e,t){return e.map(e=>({...e,position:{...e.position,y:e.position.y+e.speed*(t/16)}})).filter(e=>e.position.y<r.CANVAS_HEIGHT+50)}getCurrentSpeed(){let e=Math.floor((Date.now()-this.gameStartTime)/r.SPEED_INCREASE_INTERVAL);return this.baseSpeed*Math.pow(1+r.SPEED_INCREASE_RATE,e)}constructor(){this.baseSpeed=2,this.lastSpawnTime=0,this.gameStartTime=0,this.gameStartTime=Date.now()}}class d{static checkCollision(e,t){let i=.2*Math.min(e.size.width,e.size.height),s=.2*Math.min(t.size.width,t.size.height),a=e.position.x+i,n=e.position.x+e.size.width-i,r=e.position.y+i,h=e.position.y+e.size.height-i,o=t.position.x+s,l=t.position.x+t.size.width-s,c=t.position.y+s,d=t.position.y+t.size.height-s;return a<l&&n>o&&r<d&&h>c}}class u{static calculateFinalScore(e,t){return 10*Math.floor(e/1e3)+50*t}static getTopScores(){try{let e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return[]}}static saveScore(e,t){try{let i=this.getTopScores(),s={initials:e,score:t,date:new Date().toISOString()};i.push(s),i.sort((e,t)=>t.score-e.score);let a=i.slice(0,10);return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a)),!0}catch(e){return!1}}static isTopScore(e){let t=this.getTopScores();return t.length<10||e>t[t.length-1].score}}function m(){let e=(0,a.useRef)(null),[t,i]=(0,a.useState)(n()),[m,g]=(0,a.useState)(!1),[p,v]=(0,a.useState)(""),x=(0,a.useRef)(new l),f=(0,a.useRef)(new c),y=(0,a.useRef)(null),E=(0,a.useRef)(null),S=(0,a.useRef)(0);return(0,a.useRef)(0),(0,a.useEffect)(()=>{let t=e.current;if(!t)return;let i=t.getContext("2d");if(i)return t.width=r.CANVAS_WIDTH,t.height=r.CANVAS_HEIGHT,E.current=new h(i),x.current.init(t),()=>{x.current.cleanup(),y.current&&y.current.stop()}},[]),(0,a.useEffect)(()=>{E.current&&E.current.render(t)},[t]),(0,s.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-black",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("canvas",{ref:e,className:"game-canvas"}),!t.isPlaying&&!t.isGameOver&&(0,s.jsx)("div",{className:"game-overlay",children:(0,s.jsxs)("div",{className:"game-modal text-2xl",children:[(0,s.jsx)("div",{className:"mb-5",children:"루피의 아카이누 주먹 피하기"}),(0,s.jsx)("button",{onClick:()=>{S.current=Date.now(),f.current.reset(),i({...n(),isPlaying:!0}),y.current&&y.current.stop(),y.current=new o(e=>{i(t=>{if(!t.isPlaying||t.isPaused||t.isGameOver)return t;let i=Date.now(),s=i-S.current,a={...t};a.runtime=s;let n=x.current.getTouchPosition();if(null!==n){let e=a.player.position.x+a.player.size.width/2,t=n-a.player.size.width/2,i=Math.max(0,Math.min(r.CANVAS_WIDTH-a.player.size.width,t)),s=i+a.player.size.width/2;Math.abs(s-e)>1&&(s>e?a.player.direction="right":s<e&&(a.player.direction="left")),a.player.position.x=i}else{let t=x.current.getMovementDirection();if(t){let i=r.PLAYER_SPEED*(e/16);"left"===t?(a.player.position.x=Math.max(0,a.player.position.x-i),a.player.direction="left"):(a.player.position.x=Math.min(r.CANVAS_WIDTH-a.player.size.width,a.player.position.x+i),a.player.direction="right")}}if(f.current.shouldSpawnEnemy(i)){let e=f.current.createEnemy();a.enemies.push(e)}a.enemies=f.current.updateEnemies(a.enemies,e);let h=t.enemies.length-a.enemies.length;for(let e of(h>0&&(a.score+=h),a.enemies))if(d.checkCollision(a.player,e)){var o;let e=u.calculateFinalScore(a.runtime,a.score),t={...a,isGameOver:!0,isPlaying:!1};return null==(o=y.current)||o.stop(),u.isTopScore(e)&&g(!0),t}return a})}),y.current.start()},className:"game-button game-button-primary shadow-2xl",children:"게임 시작"})]})}),t.isGameOver&&!m&&(0,s.jsx)("div",{className:"game-overlay",children:(0,s.jsxs)("div",{className:"game-modal text-lg max-w-md w-full mx-4",children:[(0,s.jsx)("div",{className:"mb-5 text-2xl font-bold",children:"\uD83C\uDFC6 TOP 10 랭킹 \uD83C\uDFC6"}),(0,s.jsx)("div",{className:"max-h-80 overflow-y-auto mb-6",children:0===u.getTopScores().length?(0,s.jsx)("div",{className:"text-gray-400 py-8",children:"아직 기록이 없습니다."}):(0,s.jsx)("div",{className:"space-y-2",children:u.getTopScores().map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between items-center p-3 rounded-lg ".concat(t<3?"bg-gradient-to-r from-yellow-600/20 to-orange-600/20 border border-yellow-500/30":"bg-gray-800/50"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("span",{className:"text-lg font-bold ".concat(0===t?"text-yellow-400":1===t?"text-gray-300":2===t?"text-orange-400":"text-gray-400"),children:["#",t+1]}),(0,s.jsx)("span",{className:"font-semibold text-white",children:e.initials})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-lg font-bold text-teal-400",children:[e.score.toLocaleString(),"점"]}),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.date).toLocaleDateString("ko-KR")})]})]},t))})}),(0,s.jsxs)("div",{className:"flex justify-between items-center bg-gray-800/70 p-4 rounded-lg border border-gray-600",children:[(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("div",{className:"text-sm text-gray-400",children:"내 점수"}),(0,s.jsxs)("div",{className:"text-xl font-bold text-teal-400",children:[u.calculateFinalScore(t.runtime,t.score).toLocaleString(),"점"]}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:["시간: ",Math.floor(t.runtime/1e3),"초 | 피한 주먹: ",t.score,"개"]})]}),(0,s.jsx)("button",{onClick:()=>{i(n()),g(!1),v("")},className:"game-button game-button-secondary ml-4",children:"다시 시작"})]})]})}),m&&(0,s.jsx)("div",{className:"game-overlay",children:(0,s.jsxs)("div",{className:"game-modal text-lg",children:[(0,s.jsx)("div",{className:"mb-5 text-2xl",children:"\uD83C\uDF89 TOP 10 진입! \uD83C\uDF89"}),(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),p.length>=2){let e=u.calculateFinalScore(t.runtime,t.score);u.saveScore(p.toUpperCase(),e),g(!1),v("")}},children:[(0,s.jsx)("input",{type:"text",value:p,onChange:e=>v(e.target.value.slice(0,3)),placeholder:"이니셜 입력",className:"p-3 text-base text-center uppercase bg-gray-700 text-white border-2 border-gray-500 rounded-lg focus:outline-none focus:border-teal-400 focus:ring-2 focus:ring-teal-400/50",autoFocus:!0}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("button",{type:"submit",disabled:p.length<2,className:"px-5 py-2 text-base rounded-lg transition-all ".concat(p.length>=2?"bg-teal-400 hover:bg-teal-300 cursor-pointer":"bg-gray-600 cursor-not-allowed"," text-white"),children:"저장"})})]})]})})]})})}u.STORAGE_KEY="luffy_game_scores"},9386:(e,t,i)=>{Promise.resolve().then(i.bind(i,4379))}},e=>{e.O(0,[441,255,358],()=>e(e.s=9386)),_N_E=e.O()}]);