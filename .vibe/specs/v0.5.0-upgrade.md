# VIBE v0.5.0 고도화 SPEC (최종)

## Overview

Oh My OpenCode 분석을 바탕으로 VIBE를 고도화합니다.

**핵심 원칙**:
- Claude Code 특화 (기본)
- Task 도구 기반 멀티 모델 오케스트레이션
- 외부 LLM은 선택적 확장 (GPT, Gemini)
- SPEC 중심 워크플로우 유지

---

## 아키텍처

```
사용자 요청
      ↓
┌─────────────────────────────────────────────────────────┐
│              Orchestrator (Opus 4.5)                    │
│              메인 세션 - 전체 흐름 조율                   │
└─────────────────────────┬───────────────────────────────┘
                          │
    ┌─────────────────────┼─────────────────────┐
    ↓                     ↓                     ↓
┌─────────┐         ┌─────────┐         ┌─────────┐
│  Task   │         │  Task   │         │  Task   │
│ (haiku) │         │(sonnet) │         │ (haiku) │
│코드 탐색│         │핵심 구현│         │테스트   │
└─────────┘         └─────────┘         └─────────┘
    │                     │                     │
    ↓                     ↓                     ↓
┌─────────┐         ┌─────────┐         ┌─────────┐
│MCP: GPT │         │MCP:Gemini│        │MCP:Context7│
│(선택적) │         │(선택적)  │         │(기본)   │
│설계 자문│         │UI 리뷰   │         │문서 검색│
└─────────┘         └─────────┘         └─────────┘
```

---

## Phase 1: MCP 자동 설치

### 기본 MCP (vibe init 시 자동)

| MCP | 용도 |
|-----|------|
| hi-ai | 기존 유지 |
| Context7 | 라이브러리 문서 검색 |
| Exa | AI 웹 검색 |

### 구현

**파일**: `bin/vibe` - `init()` 함수

```javascript
const defaultMCPs = [
  { name: 'vibe', path: 'hi-ai' },           // 기존
  { name: 'context7', npx: '@upstash/context7-mcp' },
  { name: 'exa', npx: '@anthropics/exa-mcp', env: 'EXA_API_KEY' }
];
```

### Acceptance Criteria
- [ ] vibe init 시 Context7 MCP 자동 등록
- [ ] vibe init 시 Exa MCP 등록 (API 키 안내)
- [ ] vibe update 시에도 MCP 등록 확인

---

## Phase 2: 외부 LLM 선택적 확장

### 명령어

```bash
# GPT 활성화
vibe gpt sk-proj-xxxxx

# Gemini 활성화
vibe gemini AIzaSy...

# 상태 확인
vibe status

# 비활성화
vibe gpt --remove
vibe gemini --remove
```

### 구현

**파일**: `bin/vibe`

```javascript
case 'gpt':
  if (args[1] === '--remove') {
    removeExternalLLM('gpt');
  } else {
    setupExternalLLM('gpt', args[1]);
  }
  break;

case 'gemini':
  if (args[1] === '--remove') {
    removeExternalLLM('gemini');
  } else {
    setupExternalLLM('gemini', args[1]);
  }
  break;

case 'status':
  showStatus();
  break;
```

**MCP 서버** (오픈소스 활용):
- GPT: `@anthropics/openai-mcp` 또는 유사 패키지
- Gemini: `@anthropics/gemini-mcp` 또는 유사 패키지

### 활용 흐름

```
/vibe.spec "복잡한 기능"
      ↓
[Claude Opus] SPEC 초안 작성
      ↓
[GPT 활성화됨?] → MCP로 설계 교차 검토
      ↓
[Gemini 활성화됨?] → MCP로 UI/UX 자문
      ↓
[Claude] 최종 SPEC 확정
```

### Acceptance Criteria
- [ ] vibe gpt <key> 명령어 구현
- [ ] vibe gemini <key> 명령어 구현
- [ ] vibe status 명령어 구현
- [ ] vibe gpt --remove / gemini --remove 구현
- [ ] .vibe/config.json에 활성화 상태 저장

---

## Phase 3: Task 기반 멀티 모델 오케스트레이션

### 모델별 역할 분담

| 단계 | 모델 | Task 파라미터 |
|------|------|---------------|
| SPEC 작성 | Opus 4.5 | 메인 세션 |
| 코드 탐색 | Haiku | `model: "haiku"` |
| 핵심 구현 | Sonnet 4 | `model: "sonnet"` |
| 테스트 작성 | Haiku | `model: "haiku"` |
| 설계 자문 | Opus | `model: "opus"` |
| 검증 | Sonnet | `model: "sonnet"` |

### 슬래시 커맨드 개선

**vibe.run.md**:
```markdown
## Phase 실행 시 Task 병렬 호출

Phase별로 적절한 모델의 Task를 병렬 호출:

1. Task(haiku) - 코드베이스 분석
2. Task(sonnet) - 핵심 구현
3. Task(haiku) - 테스트 코드 생성

외부 LLM 활성화 시:
- GPT MCP로 설계 검토 요청
- Gemini MCP로 UI 리뷰 요청
```

### Acceptance Criteria
- [ ] vibe.run에서 Task 병렬 호출 로직
- [ ] 외부 LLM 활성화 시 자동 활용
- [ ] Phase별 적절한 모델 선택

---

## Phase 4: 훅 시스템 강화

### 추가할 훅

| 훅 | 목적 | 우선순위 |
|----|------|----------|
| todo-continuation | 미완료 작업 강제 | 높음 |
| preemptive-compaction | 토큰 75% 시 요약 권고 | 높음 |
| comment-checker | 과도한 주석 경고 | 중간 |

### 구현

**파일**: `templates/hooks-template.json`

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": ".vibe/rules/quality/checklist.md 기준으로 코드를 검토하세요. 과도한 주석이 있으면 제거하세요."
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": ".*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "미완료 작업이 있으면 TODO로 기록하고 다음 세션에서 이어갈 수 있도록 하세요."
          }
        ]
      }
    ]
  }
}
```

### Acceptance Criteria
- [ ] PostToolUse 훅 강화 (comment-checker)
- [ ] Stop 훅 추가 (todo-continuation)
- [ ] 토큰 관리 가이드 추가

---

## 파일 변경 요약

| 파일 | 변경 내용 |
|------|-----------|
| `bin/vibe` | gpt, gemini, status 명령어 추가 |
| `bin/vibe` | MCP 자동 설치 로직 추가 |
| `templates/hooks-template.json` | 훅 확장 |
| `.claude/commands/vibe.run.md` | Task 병렬 호출 로직 |
| `.claude/commands/vibe.spec.md` | 외부 LLM 연동 |
| `package.json` | 버전 0.5.0 |

---

## CLI 명령어 최종

```bash
# 기본
vibe init [project]     # 프로젝트 초기화
vibe update             # 설정 업데이트
vibe help               # 도움말
vibe version            # 버전 정보

# 외부 LLM (선택적)
vibe gpt <api-key>      # GPT 활성화
vibe gemini <api-key>   # Gemini 활성화
vibe gpt --remove       # GPT 비활성화
vibe gemini --remove    # Gemini 비활성화
vibe status             # 현재 설정 상태
```

---

## 버전 정보

- 현재: v0.4.9
- 목표: v0.5.0
- 코드명: "Multi-Model Orchestration"

---

## 구현 순서

1. **Phase 1**: MCP 자동 설치 (Context7, Exa)
2. **Phase 2**: 외부 LLM 명령어 (vibe gpt, vibe gemini)
3. **Phase 3**: Task 기반 오케스트레이션 (vibe.run 개선)
4. **Phase 4**: 훅 시스템 강화
