# VIBE v1.0.0 - Multi-Model Orchestration

## Overview

Oh My OpenCode 분석을 바탕으로 VIBE를 멀티 모델 오케스트레이션 프레임워크로 고도화.

**핵심 원칙**:
- Claude Code 특화 (기본)
- 외부 LLM은 선택적 확장 (GPT, Gemini)
- 각 모델의 강점에 맞는 역할 분담
- SPEC 중심 워크플로우 유지

---

## 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    Opus 4.5 (오케스트레이터)                      │
│                    - 전체 흐름 조율                               │
│                    - 최종 결정                                   │
│                    - SPEC 작성 (기본)                            │
└─────────────────────────────┬───────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ↓                     ↓                     ↓
┌───────────────┐      ┌───────────────┐      ┌───────────────┐
│   Sonnet 4    │      │  Haiku 3.5    │      │  MCP 도구     │
│   (구현)       │      │  (탐색)       │      │               │
└───────────────┘      └───────────────┘      └───────┬───────┘
                                                      │
                                        ┌─────────────┼─────────────┐
                                        ↓             ↓             ↓
                                  ┌─────────┐   ┌─────────┐   ┌─────────┐
                                  │GPT 5.2  │   │Gemini 3 │   │Context7 │
                                  │(선택적) │   │(선택적) │   │  Exa    │
                                  │아키텍처 │   │ UI/UX   │   │(기본)   │
                                  └─────────┘   └─────────┘   └─────────┘
```

---

## 역할 분담

### 기본 (Claude만)

| 역할 | 모델 | Task 파라미터 |
|------|------|---------------|
| 오케스트레이터 | Opus 4.5 | 메인 세션 |
| SPEC 작성 | Opus 4.5 | 메인 세션 |
| 아키텍처/디버깅 | Opus 4.5 | 메인 세션 |
| UI/UX 설계 | Opus 4.5 | 메인 세션 |
| 구현 | Sonnet 4 | `model: "sonnet"` |
| 코드 탐색 | Haiku 3.5 | `model: "haiku"` |
| 문서 탐색 | Sonnet 4 | `model: "sonnet"` |

### GPT 키 있을 때

| 역할 | 모델 |
|------|------|
| 오케스트레이터 | Opus 4.5 |
| 아키텍처/디버깅 | **GPT 5.2** (MCP) |
| 나머지 | 동일 |

### Gemini 키 있을 때

| 역할 | 모델 |
|------|------|
| 오케스트레이터 | Opus 4.5 |
| UI/UX 설계 | **Gemini 3** (MCP) |
| 나머지 | 동일 |

### 모든 키 있을 때

| 역할 | 모델 |
|------|------|
| 오케스트레이터 | Opus 4.5 |
| 아키텍처/디버깅 | **GPT 5.2** |
| UI/UX 설계 | **Gemini 3** |
| 구현 | Sonnet 4 |
| 탐색 | Haiku 3.5 |

---

## Phase 1: MCP 자동 설치

### 기본 MCP (vibe init 시 자동)

| MCP | 용도 |
|-----|------|
| hi-ai | 기존 유지 |
| Context7 | 라이브러리 문서 검색 |
| Exa | AI 웹 검색 |

### 구현

**파일**: `bin/vibe` - `init()` 함수 수정

```javascript
const defaultMCPs = [
  { name: 'vibe', type: 'node', path: 'hi-ai/dist/index.js' },
  { name: 'context7', type: 'npx', package: '@upstash/context7-mcp@latest' },
  { name: 'exa', type: 'npx', package: 'exa-mcp-server@latest', env: 'EXA_API_KEY' }
];
```

### Acceptance Criteria
- [ ] vibe init 시 Context7 MCP 자동 등록
- [ ] vibe init 시 Exa MCP 등록 (API 키 안내)
- [ ] vibe update 시에도 MCP 등록 확인

---

## Phase 2: 외부 LLM 통합

### CLI 명령어

```bash
# GPT 활성화 (아키텍처/디버깅 역할)
vibe gpt <api-key>

# Gemini 활성화 (UI/UX 역할)
vibe gemini <api-key>

# 상태 확인
vibe status

# 비활성화
vibe gpt --remove
vibe gemini --remove
```

### 구현

**파일**: `bin/vibe`

```javascript
case 'gpt':
  if (args[1] === '--remove') {
    removeExternalLLM('gpt');
  } else {
    setupExternalLLM('gpt', args[1], {
      role: 'architecture',
      model: 'gpt-5.2'
    });
  }
  break;

case 'gemini':
  if (args[1] === '--remove') {
    removeExternalLLM('gemini');
  } else {
    setupExternalLLM('gemini', args[1], {
      role: 'ui-ux',
      model: 'gemini-3-pro'
    });
  }
  break;

case 'status':
  showStatus();
  break;
```

**MCP 서버** (오픈소스 활용):
- GPT: 기존 OpenAI MCP 서버 활용
- Gemini: 기존 Gemini MCP 서버 활용

### 설정 저장

**파일**: `.vibe/config.json`

```json
{
  "language": "ko",
  "models": {
    "gpt": {
      "enabled": true,
      "role": "architecture",
      "model": "gpt-5.2"
    },
    "gemini": {
      "enabled": false,
      "role": "ui-ux",
      "model": "gemini-3-pro"
    }
  }
}
```

### Acceptance Criteria
- [ ] vibe gpt <key> 명령어 구현
- [ ] vibe gemini <key> 명령어 구현
- [ ] vibe status 명령어 구현
- [ ] vibe gpt --remove / gemini --remove 구현
- [ ] .vibe/config.json에 설정 저장
- [ ] MCP 서버 자동 등록/해제

---

## Phase 3: Task 기반 오케스트레이션

### 슬래시 커맨드 개선

**vibe.run.md**:
- Phase별 적절한 모델 Task 호출
- 외부 LLM 활성화 시 해당 역할에 MCP 호출
- 병렬 실행 지원

```markdown
## 실행 흐름

1. SPEC 로드 → Phase 분석
2. 각 Phase 작업 분류:
   - 아키텍처 결정 → GPT MCP (있으면) / Opus
   - UI/UX 작업 → Gemini MCP (있으면) / Opus
   - 구현 → Task(sonnet)
   - 탐색 → Task(haiku)
3. 결과 종합 → Opus 최종 검토
```

### Acceptance Criteria
- [ ] vibe.run에서 역할별 모델 분기
- [ ] 외부 LLM MCP 자동 호출
- [ ] Task 병렬 실행

---

## Phase 4: 훅 시스템 강화

### 추가할 훅

| 훅 | 목적 |
|----|------|
| todo-continuation | 미완료 작업 강제 |
| comment-checker | 과도한 주석 경고 |

### 구현

**파일**: `templates/hooks-template.json`

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": ".vibe/rules/quality/checklist.md 기준으로 코드를 검토하세요. 과도한 주석이 있으면 제거하세요."
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": ".*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "미완료 작업이 있으면 TODO로 기록하고 다음 세션에서 이어갈 수 있도록 하세요."
          }
        ]
      }
    ]
  }
}
```

### Acceptance Criteria
- [ ] PostToolUse 훅 강화
- [ ] Stop 훅 추가

---

## 파일 변경 요약

| 파일 | 변경 내용 |
|------|-----------|
| `bin/vibe` | gpt, gemini, status 명령어 추가, MCP 자동 설치 |
| `templates/hooks-template.json` | 훅 확장 |
| `.claude/commands/vibe.run.md` | 역할별 모델 분기 로직 |
| `.claude/commands/vibe.spec.md` | 외부 LLM 연동 안내 |
| `package.json` | 버전 1.0.0 |

---

## CLI 명령어 최종

```bash
# 기본
vibe init [project]     # 프로젝트 초기화
vibe update             # 설정 업데이트
vibe help               # 도움말
vibe version            # 버전 정보

# 외부 LLM (선택적)
vibe gpt <api-key>      # GPT 활성화 (아키텍처/디버깅)
vibe gemini <api-key>   # Gemini 활성화 (UI/UX)
vibe gpt --remove       # GPT 비활성화
vibe gemini --remove    # Gemini 비활성화
vibe status             # 현재 설정 상태
```

---

## 버전 정보

- 현재: v0.4.9
- 목표: **v1.0.0**
- 코드명: "Multi-Model Orchestration"

---

## 구현 순서

1. **Phase 1**: MCP 자동 설치 (Context7, Exa)
2. **Phase 2**: 외부 LLM 명령어 (vibe gpt, vibe gemini)
3. **Phase 3**: Task 기반 오케스트레이션 (vibe.run 개선)
4. **Phase 4**: 훅 시스템 강화
